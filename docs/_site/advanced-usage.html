<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/pseudoksmt-website/assets/css/just-the-docs-default.css">

  

  
    <script src="/pseudoksmt-website/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/pseudoksmt-website/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Advanced usage | KSMT</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Advanced usage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Kotlin API for SMT solvers" />
<meta property="og:description" content="Kotlin API for SMT solvers" />
<link rel="canonical" href="http://localhost:4000/pseudoksmt-website/advanced-usage.html" />
<meta property="og:url" content="http://localhost:4000/pseudoksmt-website/advanced-usage.html" />
<meta property="og:site_name" content="KSMT" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Advanced usage" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Kotlin API for SMT solvers","headline":"Advanced usage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/pseudoksmt-website/assets/img/ksmt-logo-black6.png"}},"url":"http://localhost:4000/pseudoksmt-website/advanced-usage.html"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<body>
<a class="skip-to-main" href="#main-content">Skip to main content</a>
<svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

<div class="side-bar">
    <div class="site-header" role="banner">
        <a href="/pseudoksmt-website/" class="site-title lh-tight"><!--<img src="/assets/img/ksmt-logo-black2.png" width="60">-->
<!--<pre> </pre>-->

<!---->
<!--<div class="site-logo" role="img" aria-label="KSMT"></div>-->
<!--<img src="/docs/assets/img/ksmt-logo-black2.png">-->
<!---->


    <div class="site-logo"></div>
</a>
        <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
            <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
            </a>
    </div>
    <nav aria-label="Main" id="site-nav" class="site-nav">
        
        
        <ul class="nav-list"><li class="nav-list-item"><a href="/pseudoksmt-website/" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="/pseudoksmt-website/getting-started.html" class="nav-list-link">Getting started</a></li><li class="nav-list-item active"><a href="/pseudoksmt-website/advanced-usage.html" class="nav-list-link active">Advanced usage</a></li><li class="nav-list-item"><a href="/pseudoksmt-website/custom-expressions.html" class="nav-list-link">Custom expressions</a></li><li class="nav-list-item"><a href="/pseudoksmt-website/api/" class="nav-list-link">API reference</a></li></ul>
        
    </nav>

    
    
<!--    <footer class="site-footer">-->
<!--        This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.-->
<!--    </footer>-->
    
</div>

<div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search KSMT" aria-label="Search KSMT" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
    <nav aria-label="Auxiliary" class="aux-nav">
  <ul class="aux-nav-list">
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/ksmt" class="site-button"
          
          target="_blank" rel="noopener noreferrer"
          
        >
          KSMT on GitHub
        </a>
      </li>
    
  </ul>
</nav>

  
</div>

    <div id="main-content-wrap" class="main-content-wrap">
        
        <div id="main-content" class="main-content">
            <main>
                
                <h1 class="no_toc" id="advanced-usage">
  
  
    <a href="#advanced-usage" class="anchor-heading" aria-labelledby="advanced-usage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced usage
  
  
</h1>
    

<p>For basic KSMT usage, please refer to <a href="getting-started">Getting started</a> guide.</p>

<p>Having tried the essential scenarios, find the 
<a href="https://github.com/UnitTestBot/ksmt/tree/main/examples/src/main/kotlin/AdvancedExamples.kt">advanced example</a> and 
proceed to advanced usage.</p><hr />
<details open="">
  <summary class="text-delta">
    Table of contents:
  </summary>
<ol id="markdown-toc">
  <li><a href="#working-with-smt-formulas" id="markdown-toc-working-with-smt-formulas">Working with SMT formulas</a>    <ol>
      <li><a href="#parsing-formulas-in-smt-lib2-format" id="markdown-toc-parsing-formulas-in-smt-lib2-format">Parsing formulas in SMT-LIB2 format</a></li>
      <li><a href="#default-simplification" id="markdown-toc-default-simplification">Default simplification</a></li>
      <li><a href="#manual-simplification" id="markdown-toc-manual-simplification">Manual simplification</a></li>
      <li><a href="#expression-substitution" id="markdown-toc-expression-substitution">Expression substitution</a></li>
    </ol>
  </li>
  <li><a href="#working-with-smt-solvers" id="markdown-toc-working-with-smt-solvers">Working with SMT solvers</a>    <ol>
      <li><a href="#solver-configuration" id="markdown-toc-solver-configuration">Solver configuration</a></li>
      <li><a href="#solver-independent-models" id="markdown-toc-solver-independent-models">Solver-independent models</a></li>
      <li><a href="#solver-runner" id="markdown-toc-solver-runner">Solver runner</a></li>
      <li><a href="#using-custom-solvers-in-a-runner" id="markdown-toc-using-custom-solvers-in-a-runner">Using custom solvers in a runner</a></li>
      <li><a href="#solver-portfolio" id="markdown-toc-solver-portfolio">Solver portfolio</a></li>
    </ol>
  </li>
</ol>

</details><hr />
<h2 id="working-with-smt-formulas">
  
  
    <a href="#working-with-smt-formulas" class="anchor-heading" aria-labelledby="working-with-smt-formulas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Working with SMT formulas
  
  
</h2>
    

<p>Learn how to parse, simplify, and substitute expressions.</p><hr />
<h3 id="parsing-formulas-in-smt-lib2-format">
  
  
    <a href="#parsing-formulas-in-smt-lib2-format" class="anchor-heading" aria-labelledby="parsing-formulas-in-smt-lib2-format"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Parsing formulas in SMT-LIB2 format
  
  
</h3>
    

<p>KSMT provides an API for parsing formulas in the SMT-LIB2 format.
Currently, KSMT provides a parser implemented on top of the Z3 solver API, and therefore <code class="language-plaintext highlighter-rouge">ksmt-z3</code> module is 
required for parsing.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">formula</span> <span class="p">=</span> <span class="s">"""
    (declare-fun x () Int)
    (declare-fun y () Int)
    (assert (&gt;= x y))
    (assert (&gt;= y x))
"""</span>
<span class="nf">with</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">val</span> <span class="py">assertions</span> <span class="p">=</span> <span class="nc">KZ3SMTLibParser</span><span class="p">().</span><span class="nf">parse</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><hr />
<h3 id="default-simplification">
  
  
    <a href="#default-simplification" class="anchor-heading" aria-labelledby="default-simplification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Default simplification
  
  
</h3>
    

<p>By default, <code class="language-plaintext highlighter-rouge">KContext</code> attempts to apply lightweight simplifications when you create an expression. If you do not 
need simplifications, disable them using the <code class="language-plaintext highlighter-rouge">KContext.simplificationMode</code> parameter.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Simplification is enabled by default</span>
<span class="kd">val</span> <span class="py">simplifyingContext</span> <span class="p">=</span> <span class="nc">KContext</span><span class="p">()</span>

<span class="c1">// Disable simplifications on a context level</span>
<span class="kd">val</span> <span class="py">nonSimplifyingContext</span> <span class="p">=</span> <span class="nc">KContext</span><span class="p">(</span><span class="n">simplificationMode</span> <span class="p">=</span> <span class="nc">KContext</span><span class="p">.</span><span class="nc">SimplificationMode</span><span class="p">.</span><span class="nc">NO_SIMPLIFY</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">simplifiedExpr</span> <span class="p">=</span> <span class="nf">with</span><span class="p">(</span><span class="n">simplifyingContext</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">val</span> <span class="py">a</span> <span class="k">by</span> <span class="n">boolSort</span>
   <span class="p">!(</span><span class="n">a</span> <span class="n">and</span> <span class="n">falseExpr</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">val</span> <span class="py">nonSimplifiedExpr</span> <span class="p">=</span> <span class="nf">with</span><span class="p">(</span><span class="n">nonSimplifyingContext</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">val</span> <span class="py">a</span> <span class="k">by</span> <span class="n">boolSort</span>
   <span class="p">!(</span><span class="n">a</span> <span class="n">and</span> <span class="n">falseExpr</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">println</span><span class="p">(</span><span class="n">nonSimplifiedExpr</span><span class="p">)</span> <span class="c1">// (not (and a false))</span>
<span class="nf">println</span><span class="p">(</span><span class="n">simplifiedExpr</span><span class="p">)</span> <span class="c1">// true</span>
</code></pre></div></div><hr />
<h3 id="manual-simplification">
  
  
    <a href="#manual-simplification" class="anchor-heading" aria-labelledby="manual-simplification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Manual simplification
  
  
</h3>
    

<p>KSMT provides <code class="language-plaintext highlighter-rouge">KExprSimplifier</code>, so you can manually simplify an arbitrary expression.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Context does not simplify expressions during creation</span>
<span class="kd">val</span> <span class="py">ctx</span> <span class="p">=</span> <span class="nc">KContext</span><span class="p">(</span><span class="n">simplificationMode</span> <span class="p">=</span> <span class="nc">KContext</span><span class="p">.</span><span class="nc">SimplificationMode</span><span class="p">.</span><span class="nc">NO_SIMPLIFY</span><span class="p">)</span>

<span class="nf">with</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">val</span> <span class="py">a</span> <span class="k">by</span> <span class="n">boolSort</span>
   <span class="kd">val</span> <span class="py">nonSimplifiedExpr</span> <span class="p">=</span> <span class="p">!(</span><span class="n">a</span> <span class="n">and</span> <span class="n">falseExpr</span><span class="p">)</span>

   <span class="kd">val</span> <span class="py">simplifier</span> <span class="p">=</span> <span class="nc">KExprSimplifier</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
   <span class="kd">val</span> <span class="py">simplifiedExpr</span> <span class="p">=</span> <span class="n">simplifier</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">nonSimplifiedExpr</span><span class="p">)</span>

   <span class="nf">println</span><span class="p">(</span><span class="n">nonSimplifiedExpr</span><span class="p">)</span> <span class="c1">// (not (and a false))</span>
   <span class="nf">println</span><span class="p">(</span><span class="n">simplifiedExpr</span><span class="p">)</span> <span class="c1">// true</span>
<span class="p">}</span>
</code></pre></div></div><hr />
<h3 id="expression-substitution">
  
  
    <a href="#expression-substitution" class="anchor-heading" aria-labelledby="expression-substitution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Expression substitution
  
  
</h3>
    

<p>KSMT provides <code class="language-plaintext highlighter-rouge">KExprSubstitutor</code>, so you can replace all the expression occurrences with another
expression.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">a</span> <span class="k">by</span> <span class="n">boolSort</span>
<span class="kd">val</span> <span class="py">b</span> <span class="k">by</span> <span class="n">boolSort</span>
<span class="kd">val</span> <span class="py">expr</span> <span class="p">=</span> <span class="p">!(</span><span class="n">a</span> <span class="n">and</span> <span class="n">b</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">substitutor</span> <span class="p">=</span> <span class="nc">KExprSubstitutor</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">apply</span> <span class="p">{</span>
   <span class="c1">// Substitute all occurrences of `b` with `false`</span>
   <span class="nf">substitute</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">falseExpr</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">val</span> <span class="py">exprAfterSubstitution</span> <span class="p">=</span> <span class="n">substitutor</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

<span class="nf">println</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="c1">// (not (and a b))</span>
<span class="nf">println</span><span class="p">(</span><span class="n">exprAfterSubstitution</span><span class="p">)</span> <span class="c1">// true</span>
</code></pre></div></div><hr />
<h2 id="working-with-smt-solvers">
  
  
    <a href="#working-with-smt-solvers" class="anchor-heading" aria-labelledby="working-with-smt-solvers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Working with SMT solvers
  
  
</h2>
    

<p>Learn how to configure and run solvers, get models, and switch to portfolio mode.</p><hr />
<h3 id="solver-configuration">
  
  
    <a href="#solver-configuration" class="anchor-heading" aria-labelledby="solver-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Solver configuration
  
  
</h3>
    

<p>KSMT provides an API for modifying solver-specific parameters.
Since the parameters and their correct values are solver-specific,
KSMT does not perform any checks.
See corresponding solver documentation for a list of available options.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">with</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
   <span class="nc">KZ3Solver</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">use</span> <span class="p">{</span> <span class="n">solver</span> <span class="p">-&gt;</span>
      <span class="n">solver</span><span class="p">.</span><span class="nf">configure</span> <span class="p">{</span>
         <span class="c1">// set Z3 solver `random_seed` parameter to 42 </span>
         <span class="nf">setZ3Option</span><span class="p">(</span><span class="s">"random_seed"</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><hr />
<h3 id="solver-independent-models">
  
  
    <a href="#solver-independent-models" class="anchor-heading" aria-labelledby="solver-independent-models"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Solver-independent models
  
  
</h3>
    

<p>By default, SMT solver models are lazily initialized.
The values of the declared variables are loaded from the underlying solver native model on demand.
Therefore, models become invalid as soon as the solver closes. Moreover, solvers like Bitwuzla invalidate their models 
each time <code class="language-plaintext highlighter-rouge">check-sat</code> is called.
To overcome these problems, KSMT provides the <code class="language-plaintext highlighter-rouge">KModel.detach</code> function that allows you to make the model independent of
the underlying native representation.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">a</span> <span class="k">by</span> <span class="n">boolSort</span>
<span class="kd">val</span> <span class="py">b</span> <span class="k">by</span> <span class="n">boolSort</span>
<span class="kd">val</span> <span class="py">expr</span> <span class="p">=</span> <span class="n">a</span> <span class="n">and</span> <span class="n">b</span>

<span class="kd">val</span> <span class="p">(</span><span class="py">model</span><span class="p">,</span> <span class="py">detachedModel</span><span class="p">)</span> <span class="p">=</span> <span class="nc">KZ3Solver</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">use</span> <span class="p">{</span> <span class="n">solver</span> <span class="p">-&gt;</span>
   <span class="n">solver</span><span class="p">.</span><span class="nf">assert</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
   <span class="nf">println</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="nf">check</span><span class="p">())</span> <span class="c1">// SAT</span>
   <span class="kd">val</span> <span class="py">model</span> <span class="p">=</span> <span class="n">solver</span><span class="p">.</span><span class="nf">model</span><span class="p">()</span>

   <span class="c1">// Detach model from solver</span>
   <span class="kd">val</span> <span class="py">detachedModel</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">detach</span><span class="p">()</span>

   <span class="n">model</span> <span class="n">to</span> <span class="n">detachedModel</span>
<span class="p">}</span>

<span class="k">try</span> <span class="p">{</span>
   <span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ex</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
   <span class="nf">println</span><span class="p">(</span><span class="s">"Model no longer valid after solver close"</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">println</span><span class="p">(</span><span class="n">detachedModel</span><span class="p">.</span><span class="nf">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>Note: it is recommended to use <code class="language-plaintext highlighter-rouge">KModel.detach</code> when you need to keep the model in a <code class="language-plaintext highlighter-rouge">List</code>, for example.</p><hr />
<h3 id="solver-runner">
  
  
    <a href="#solver-runner" class="anchor-heading" aria-labelledby="solver-runner"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Solver runner
  
  
</h3>
    

<p>SMT solvers may ignore timeouts, or they suddenly crash, thus interrupting the entire application process.
KSMT provides a process-based solver runner: it runs each solver in a separate process.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a long-lived solver manager that manages a pool of solver workers</span>
<span class="nc">KSolverRunnerManager</span><span class="p">().</span><span class="nf">use</span> <span class="p">{</span> <span class="n">solverManager</span> <span class="p">-&gt;</span>

   <span class="c1">// Use solver API as usual</span>
   <span class="nf">with</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">a</span> <span class="k">by</span> <span class="n">boolSort</span>
      <span class="kd">val</span> <span class="py">b</span> <span class="k">by</span> <span class="n">boolSort</span>
      <span class="kd">val</span> <span class="py">expr</span> <span class="p">=</span> <span class="n">a</span> <span class="n">and</span> <span class="n">b</span>

      <span class="c1">// Create solver using manager instead of direct constructor invocation</span>
      <span class="n">solverManager</span><span class="p">.</span><span class="nf">createSolver</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">KZ3Solver</span><span class="o">::</span><span class="k">class</span><span class="p">).</span><span class="nf">use</span> <span class="p">{</span> <span class="n">solver</span> <span class="p">-&gt;</span>
         <span class="n">solver</span><span class="p">.</span><span class="nf">assert</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
         <span class="nf">println</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="nf">check</span><span class="p">())</span> <span class="c1">// SAT</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><hr />
<h3 id="using-custom-solvers-in-a-runner">
  
  
    <a href="#using-custom-solvers-in-a-runner" class="anchor-heading" aria-labelledby="using-custom-solvers-in-a-runner"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using custom solvers in a runner
  
  
</h3>
    

<p>Solver runner also supports user-defined solvers. Custom solvers must be registered via <code class="language-plaintext highlighter-rouge">registerSolver</code> before being used in the runner.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a long-lived solver manager that manages a pool of solver workers</span>
<span class="nc">KSolverRunnerManager</span><span class="p">().</span><span class="nf">use</span> <span class="p">{</span> <span class="n">solverManager</span> <span class="p">-&gt;</span>
   <span class="c1">// Register the user-defined solver in a current manager</span>
   <span class="n">solverManager</span><span class="p">.</span><span class="nf">registerSolver</span><span class="p">(</span><span class="nc">CustomZ3BasedSolver</span><span class="o">::</span><span class="k">class</span><span class="p">,</span> <span class="nc">KZ3SolverUniversalConfiguration</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>

   <span class="c1">// Use solver API as usual</span>
   <span class="nf">with</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">a</span> <span class="k">by</span> <span class="n">boolSort</span>
      <span class="kd">val</span> <span class="py">b</span> <span class="k">by</span> <span class="n">boolSort</span>
      <span class="kd">val</span> <span class="py">expr</span> <span class="p">=</span> <span class="n">a</span> <span class="n">and</span> <span class="n">b</span>

      <span class="c1">// Create solver using manager instead of direct constructor invocation</span>
      <span class="n">solverManager</span><span class="p">.</span><span class="nf">createSolver</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">CustomZ3BasedSolver</span><span class="o">::</span><span class="k">class</span><span class="p">).</span><span class="nf">use</span> <span class="p">{</span> <span class="n">solver</span> <span class="p">-&gt;</span>
         <span class="n">solver</span><span class="p">.</span><span class="nf">assert</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
         <span class="nf">println</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="nf">check</span><span class="p">())</span> <span class="c1">// SAT</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><hr />
<h3 id="solver-portfolio">
  
  
    <a href="#solver-portfolio" class="anchor-heading" aria-labelledby="solver-portfolio"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Solver portfolio
  
  
</h3>
    

<p>To run solvers in portfolio mode, i.e., to run them in parallel until you get the first result, try the following 
workflow, which is similar to using the solver runner:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a long-lived portfolio solver manager that manages a pool of solver workers</span>
<span class="nc">KPortfolioSolverManager</span><span class="p">(</span>
   <span class="c1">// Solvers to include in portfolio</span>
   <span class="nf">listOf</span><span class="p">(</span><span class="nc">KZ3Solver</span><span class="o">::</span><span class="k">class</span><span class="p">,</span> <span class="nc">CustomZ3BasedSolver</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="p">).</span><span class="nf">use</span> <span class="p">{</span> <span class="n">solverManager</span> <span class="p">-&gt;</span>
   <span class="c1">// Since we use the user-defined solver in our portfolio, we must register it in the current manager</span>
   <span class="n">solverManager</span><span class="p">.</span><span class="nf">registerSolver</span><span class="p">(</span><span class="nc">CustomZ3BasedSolver</span><span class="o">::</span><span class="k">class</span><span class="p">,</span> <span class="nc">KZ3SolverUniversalConfiguration</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>

   <span class="c1">// Use solver API as usual</span>
   <span class="nf">with</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">a</span> <span class="k">by</span> <span class="n">boolSort</span>
      <span class="kd">val</span> <span class="py">b</span> <span class="k">by</span> <span class="n">boolSort</span>
      <span class="kd">val</span> <span class="py">expr</span> <span class="p">=</span> <span class="n">a</span> <span class="n">and</span> <span class="n">b</span>

      <span class="c1">// Create portfolio solver using manager</span>
      <span class="n">solverManager</span><span class="p">.</span><span class="nf">createPortfolioSolver</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">use</span> <span class="p">{</span> <span class="n">solver</span> <span class="p">-&gt;</span>
         <span class="n">solver</span><span class="p">.</span><span class="nf">assert</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
         <span class="nf">println</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="nf">check</span><span class="p">())</span> <span class="c1">// SAT</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

                

                
            </main>
            

<hr>
<footer>
<!--    -->
<!--    <p><a href="#top" id="back-to-top">Back to top</a></p>-->
<!--    -->

    
<p><a href="#top" id="back-to-top">Back to top</a></p>


    
</footer>

        </div>
    </div>
    
    

<div class="search-overlay"></div>

    
</div>


</body>
</html>